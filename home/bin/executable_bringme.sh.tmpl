{{ if not .headless -}}
#!/usr/bin/env bash
# This shell script takes two arguments, WINDOW_NAME and COMMAND.
# It uses wmctrl to search for a window with a title that matches the WINDOW_NAME argument.
# If the window is found, the window is moved to the current desktop and raised
# If the window is not found, the script executes the COMMAND argument.

WINDOW_NAME=$1
COMMAND=$2

# Find all matching windows, print ID and full title
matches=($(wmctrl -l | awk -v pat="$WINDOW_NAME" 'tolower($0) ~ tolower(pat) {print $1}'))

if [ "${#matches[@]}" = "0" ]; then
    # No matching window, start the command
    bash -c "$COMMAND" &
elif [ "${#matches[@]}" = "1" ]; then
    # One match: bring that window
    wmctrl -i -R "${matches[0]}"
else
    # Multiple matches: show a menu and let user pick, or pick the first
    echo "Multiple windows found matching '$WINDOW_NAME':"
    for id in "${matches[@]}"; do
        # get full line for this ID
        title=$(wmctrl -l | grep "^$id" | cut -d' ' -f5-)
        echo "$id  $title"
    done
    echo "Bringing the first match: $title (${matches[0]})"
    wmctrl -i -R "${matches[0]}"
fi
{{ end }}
